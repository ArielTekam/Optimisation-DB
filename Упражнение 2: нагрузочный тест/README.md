# Оптимизация производительности PostgreSQL в виртуализированной среде

Данный проект документирует практическое исследование по оптимизации производительности базы данных PostgreSQL в среде виртуальных машин. Цель состояла в анализе влияния выделенных ресурсов (ОЗУ, vCPU) на производительность СУБД под нагрузкой, используя инструмент бенчмаркинга HammerDB.

## Используемые инструменты
- **Гипервизор**: VMware Workstation (изначально VirtualBox для первых попыток)
- **Системы управления базами данных (СУБД)**: PostgreSQL 15.6
- **Операционные системы виртуальных машин**: Windows Server и CentOS 8 64-бит
- **Инструмент нагрузочного тестирования**: HammerDB 4.8

## Возникшие трудности и предложенные решения

Проект начался со значительных трудностей при использовании персонального компьютера и VirtualBox для ВМ Windows Server:

### Первоначальные ограничения
1. Заполненность внутреннего жесткого диска, что вынудило работать с внешним HDD
2. Проблемы с подключением и стабильностью Windows Server в VirtualBox

### Конфигурация VirtualBox
- **Хост-машина**: Основной компьютер с VirtualBox и HammerDB
- **ВМ Ubuntu**: 
  - Ubuntu с дополнениями Guest Additions
  - PostgreSQL, настроенный на внешние подключения (IP 10.0.2.15 в NAT)
- **ВМ Windows Server**:
  - Windows Server с Guest Additions
  - PostgreSQL (postgresql-x64-15)
  - Правило брандмауэра для порта 5432
- **HammerDB**: Настроен для подключения к ВМ Windows Server

### Основные проблемы
1. Ошибка HammerDB: "server closed the connection unexpectedly" при создании схемы TPC-C
2. Сложности диагностики через журналы PostgreSQL
3. Проблемы с Windows Defender (отключение через PowerShell не помогло)

### Решения
1. **Смена гипервизора** на VMware Workstation
2. **Использование сторонней машины** для HammerDB
3. **Приоритизация CentOS 8** вместо Windows Server
   - Настройка в режиме сети "Bridged"
4. **Внешняя помощь** (Gemini) для решения сложных проблем

## Результаты тестирования

Тесты проводились с использованием бенчмарка TPC-C:
- 100 складов
- 3 виртуальных пользователя
- Длительность: 10 минут

### Базовая производительность
| Тип ВМ       | ОЗУ (ГБ) | vCPU | Время создания схемы (с) | TPM      | NOPM     |
|--------------|---------|------|--------------------------|----------|----------|
| Windows Server | 4       | 2    | 563                      | 1152.02  | 579.52   |
| CentOS 8      | 3       | 2    | 501                      | 1335.79  | 671.95   |

> CentOS 8 показал более высокую начальную производительность, чем Windows Server, даже с меньшим объемом ОЗУ (на 1 ГБ)

### Оптимизация на CentOS 8
| Конфигурация   | ОЗУ (ГБ) | vCPU | TPM       | NOPM      |
|---------------|---------|------|-----------|-----------|
| Базовый тест  | 3       | 2    | 1335.79   | 671.95    |
| Тест 2        | 2       | 2    | 2829.17   | 1422.37   |
| Тест 3        | 4       | 2    | 50944.00  | 22163.00  |
| Тест 4        | 4       | 4    | 52084.75  | 26194.27  |

### Анализ результатов
1. **Влияние ОЗУ**:
   - Увеличение с 3ГБ до 4ГБ → рост TPM на 3700%
   - ОЗУ оказалось наиболее критическим фактором

2. **Влияние vCPU**:
   - Увеличение с 2 до 4 vCPU (при 4ГБ ОЗУ) дало:
     - +2.2% по TPM
     - +18.2% по NOPM
   - Демонстрирует преимущества параллелизма после устранения ограничений по памяти

## Оптимальная конфигурация
Наилучшая производительность достигнута на конфигурации:
- **ОЗУ**: 4 ГБ
- **vCPU**: 4

Эта конфигурация показала максимальные значения количества транзакций в минуту.
